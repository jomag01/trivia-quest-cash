<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Triviabees -AI, Play, Win, Earn shop and connect</title>
    <meta name="description" content="Test your knowledge with our exciting trivia game. Earn while you play through our 7-level affiliate system and use our AI generative tools for your productivity or content.">

    <!-- Performance: DNS Prefetch and Preconnect for faster connections -->
    <link rel="dns-prefetch" href="//pcsancednuywpxvuruqb.supabase.co" />
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />
    <link rel="preconnect" href="https://pcsancednuywpxvuruqb.supabase.co" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Resource Hints: Prefetch critical routes -->
    <link rel="prefetch" href="/game" as="document" />
    <link rel="prefetch" href="/auth" as="document" />
    
    <!-- PWA & Mobile -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#8B5CF6" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Triviabees" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192x192.png" />
    
    <!-- Open Graph -->
    <meta property="og:image" content="/og-image.png" />
    <meta property="og:type" content="website" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="/og-image.png" />

    <!-- Inline Critical CSS - Eliminates render-blocking for <2s FCP -->
    <style>
      *{box-sizing:border-box;margin:0;padding:0}
      html{-webkit-text-size-adjust:100%;height:100%}
      body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0a0a0a;color:#fff;min-height:100vh;line-height:1.5}
      #root{min-height:100vh;contain:layout style}
      .ld{position:fixed;top:45%;left:50%;transform:translate(-50%,-50%);width:32px;height:32px;border:2px solid rgba(139,92,246,.15);border-top-color:#8B5CF6;border-radius:50%;animation:s 0.6s linear infinite;will-change:transform}
      @keyframes s{to{transform:translate(-50%,-50%) rotate(360deg)}}
      .ld-txt{position:fixed;top:calc(45% + 28px);left:50%;transform:translateX(-50%);font-size:13px;color:rgba(255,255,255,0.5);font-weight:500}
    </style>
    <meta property="og:title" content="Triviabees -AI, Play, Win, Earn shop and connect">
  <meta name="twitter:title" content="Triviabees -AI, Play, Win, Earn shop and connect">
  <meta property="og:description" content="Test your knowledge with our exciting trivia game. Earn while you play through our 7-level affiliate system and use our AI generative tools for your productivity or content.">
  <meta name="twitter:description" content="Test your knowledge with our exciting trivia game. Earn while you play through our 7-level affiliate system and use our AI generative tools for your productivity or content.">
  <link rel="icon" type="image/x-icon" href="https://storage.googleapis.com/gpt-engineer-file-uploads/bmToC55mC1cFkPx8wIYVwXrYDFH3/uploads/1765542570753-ChatGPT Image Dec 10, 2025, 11_14_15 PM.png">
</head>

  <body>
    <div id="root">
      <!-- Minimal loading state before React hydrates -->
      <div class="ld"></div>
      <div class="ld-txt">Loading...</div>
    </div>
    
    <!-- Main app entry - type="module" for tree-shaking -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Service Worker Registration - Deferred -->
    <script>
      // Service worker safety:
      // - cache-bust the SW script URL so updates propagate reliably on mobile networks
      // - auto-reload when a new SW is installed
      // - watchdog: if the app doesn't boot, unregister SW once and retry
      // - manual bypass: /?nosw=1 forces SW removal + reload
      (function () {
        const SW_VERSION = 'v7';

        async function clearSwAndCaches() {
          try {
            const regs = await navigator.serviceWorker.getRegistrations();
            await Promise.all(regs.map((r) => r.unregister()));
          } catch {
            // ignore
          }
          try {
            if (window.caches?.keys) {
              const keys = await caches.keys();
              await Promise.all(keys.map((k) => caches.delete(k)));
            }
          } catch {
            // ignore
          }
        }

        function stripQueryParam(url, key) {
          try {
            const u = new URL(url);
            u.searchParams.delete(key);
            return u.pathname + (u.search ? u.search : '') + (u.hash ? u.hash : '');
          } catch {
            return url;
          }
        }

        function bootWatchdog() {
          setTimeout(async () => {
            try {
              // If React didn't boot after 12s but we are online, the SW/cache may be corrupted.
              if (sessionStorage.getItem('sw_recovered') === '1') return;
              if (!navigator.onLine) return;
              if ((window).__APP_BOOTED__) return;

              await clearSwAndCaches();

              sessionStorage.setItem('sw_recovered', '1');
              window.location.reload();
            } catch {
              // ignore
            }
          }, 12000);
        }

        if (!('serviceWorker' in navigator)) return;

        // Manual recovery switch: add ?nosw=1 to the URL.
        if (new URL(window.location.href).searchParams.get('nosw') === '1') {
          clearSwAndCaches().finally(() => {
            window.location.href = stripQueryParam(window.location.href, 'nosw');
          });
          return;
        }

        window.addEventListener('load', async () => {
          try {
            const reg = await navigator.serviceWorker.register(`/sw.js?${SW_VERSION}`, { scope: '/' });

            // Try to pick up an updated SW ASAP
            reg.update?.();

            // Reload when a new worker takes control
            reg.addEventListener('updatefound', () => {
              const installing = reg.installing;
              if (!installing) return;
              installing.addEventListener('statechange', () => {
                if (installing.state === 'installed' && navigator.serviceWorker.controller) {
                  window.location.reload();
                }
              });
            });

            bootWatchdog();
          } catch {
            bootWatchdog();
          }
        });
      })();
    </script>
  </body>
</html>
